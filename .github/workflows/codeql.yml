name: "CodeQL"

on:
 push:
  branches: [main]
  paths:
   - "src/**"
   - "package.json"
   - "tsconfig.json"
 pull_request:
  branches: [main]
 schedule:
  - cron: "0 3 * * 0"

jobs:
 analyze:
  name: Analyze
  runs-on: ubuntu-latest
  permissions:
   actions: read
   contents: read
   security-events: write

  steps:
   - name: Checkout repository
     uses: actions/checkout@v4
     with:
      fetch-depth: 2

   - name: Initialize CodeQL
     uses: github/codeql-action/init@v3
     with:
      languages: "javascript-typescript"

   - name: Set up Node.js
     uses: actions/setup-node@v4
     with:
      node-version: 20
      cache: "npm"

   - name: Install dependencies
     run: npm ci

   - name: Build project (for TypeScript)
     run: npm run build

   - name: Perform CodeQL Analysis
     uses: github/codeql-action/analyze@v3
